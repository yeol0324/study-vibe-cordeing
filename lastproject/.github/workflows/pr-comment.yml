name: PR ìë™ ëŒ“ê¸€

on:
  pull_request:
    types: [opened, reopened]

jobs:
  pr-comment:
    runs-on: ubuntu-latest
    
    steps:
    - name: PR ì›°ì»´ ëŒ“ê¸€ ì¶”ê°€
      uses: actions/github-script@v7
      with:
        script: |
          const prNumber = context.payload.pull_request.number;
          const author = context.payload.pull_request.user.login;
          
          const welcomeMessage = `
          ## ğŸ‰ PRì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!
          
          ì•ˆë…•í•˜ì„¸ìš” @${author}ë‹˜! PRì„ ìƒì„±í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
          
          ### âœ… PR ì²´í¬ë¦¬ìŠ¤íŠ¸
          ë¦¬ë·° ì „ì— ë‹¤ìŒ ì‚¬í•­ë“¤ì„ í™•ì¸í•´ ì£¼ì„¸ìš”:
          
          - [ ] ì½”ë“œê°€ í”„ë¡œì íŠ¸ì˜ ì½”ë”© ìŠ¤íƒ€ì¼ì„ ë”°ë¥´ë‚˜ìš”?
          - [ ] í…ŒìŠ¤íŠ¸ê°€ ëª¨ë‘ í†µê³¼í•˜ë‚˜ìš”?
          - [ ] ìƒˆë¡œìš´ ê¸°ëŠ¥ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í–ˆë‚˜ìš”?
          - [ ] ë¬¸ì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆë‚˜ìš”? (í•„ìš”í•œ ê²½ìš°)
          - [ ] ë¸Œë ˆì´í‚¹ ì²´ì¸ì§€ê°€ ìˆë‹¤ë©´ ëª…ì‹œí–ˆë‚˜ìš”?
          
          ### ğŸ” ìë™ ì²´í¬ ì§„í–‰ ì‚¬í•­
          - ìë™ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤
          - ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ê°€ ì§„í–‰ë©ë‹ˆë‹¤
          - ë¦¬ë·°ì–´ê°€ ìë™ìœ¼ë¡œ í• ë‹¹ë©ë‹ˆë‹¤
          
          ### ğŸ“ ì¶”ê°€ ì •ë³´
          - ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”
          - ë¦¬ë·° ê³¼ì •ì—ì„œ ë³€ê²½ ìš”ì²­ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
          - ëª¨ë“  ì²´í¬ê°€ ì™„ë£Œë˜ë©´ ë¨¸ì§€ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
          
          ì¢‹ì€ ì½”ë“œ ê¸°ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸš€
          `;
          
          github.rest.issues.createComment({
            issue_number: prNumber,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: welcomeMessage
          });

  pr-test-result-comment:
    runs-on: ubuntu-latest
    needs: []
    if: always()
    
    steps:
    - name: í…ŒìŠ¤íŠ¸ ê²°ê³¼ ëŒ“ê¸€ ì¶”ê°€
      uses: actions/github-script@v7
      with:
        script: |
          // í…ŒìŠ¤íŠ¸ ì›Œí¬í”Œë¡œìš° ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ê³  ëŒ“ê¸€ ì¶”ê°€
          const prNumber = context.payload.pull_request?.number;
          if (!prNumber) return;
          
          // ì ì‹œ ëŒ€ê¸° í›„ í…ŒìŠ¤íŠ¸ ìƒíƒœ í™•ì¸
          await new Promise(resolve => setTimeout(resolve, 30000));
          
          const { data: checkRuns } = await github.rest.checks.listForRef({
            owner: context.repo.owner,
            repo: context.repo.repo,
            ref: context.payload.pull_request.head.sha,
          });
          
          const testResults = checkRuns.check_runs
            .filter(run => run.name.includes('test'))
            .map(run => `- ${run.name}: ${run.conclusion || 'in_progress'}`)
            .join('\n');
          
          if (testResults) {
            const testComment = `
            ## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë°ì´íŠ¸
            
            ${testResults}
            
            ${checkRuns.check_runs.some(run => run.conclusion === 'failure') 
              ? 'âŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ ìˆ˜ì •í•´ ì£¼ì„¸ìš”.' 
              : checkRuns.check_runs.every(run => run.conclusion === 'success')
              ? 'âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í–ˆìŠµë‹ˆë‹¤!'
              : 'â³ í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤...'}
            `;
            
            github.rest.issues.createComment({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: testComment
            });
          } 